<html>
   <head>
      <script src="https://cdn.kustomerapp.com/card-js/latest/kustomer-card.min.js"></script>
      <script>
        var lastConversationObj = null;

        function getLastConversation(conversationId){
            const params = {
                url: `/v1/conversations/${conversationId}`,
                method: "GET",
            }
         
            Kustomer.request(params, (err, response) => {
            if (err) {
                console.error(err);
            }
                console.log(response);
                lastConversationObj = response;
            });
        }

         function loadContext() {
             // Kustomer.initialize is required for card visibility in panel.
             Kustomer.initialize(function(contextJSON) {
                 console.log(contextJSON)
                 if(contextJSON?.customer?.attributes?.lastConversation?.id){
                    getLastConversation(contextJSON?.customer?.attributes?.lastConversation?.id)
                 }
             });
             
             
             
         }

         function updateConversationAttributes(conversationId, ){
            custom
            const params = {
                url: `/v1/conversations/${conversationId}`,
                method: "PATCH",
                body: {
                    custom:{
                        customerValidationSuccessfulBool: true
                    }
                }
            }
         
            Kustomer.request(params, (err, response) => {
            if (err) {
                console.error(err);
            }
                console.log(response);
            });
         }
         
         function authorizeCall(isValidated){
            if(Kustomer){
                lastConversationObj.customer.attributes.custom["customerValidationSuccessfulBool"] = isValidated;

            }else{
                console.error('Kustomer obj not found')
            }
         }    
      </script>
   </head>
   <body onload="loadContext()">
      <div class="ui card mainCard">
         <div class="content">
            <div class="ui header cardHeader">
               Caller Authentication
            </div>
         </div>
         <hr class="lineBreak">
         <br/><br/>
         <div id="container" class="ui one textArea"></div>
         <input type="button" value="Authorize" id="btnAuthorize" onClick="authorizeCall(true)" />
         <input type="button" value="Log Unauthorize" id="btnUnAuthorize" onClick="authorizeCall(false)" />
         <div id="eventLog"></div>
      </div>
   </body>
</html>